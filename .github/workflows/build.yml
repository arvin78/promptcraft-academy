- name: Hotfix (auto-patch Dart quotes)
        shell: bash
        env:
          ROOT: ${{ steps.root.outputs.root }}
        run: |
          set -e
          FILE="$ROOT/lib/src/services/error_lab_engine.dart"
          echo "Patching: $FILE"
          python3 - <<'PY'
          import os, pathlib
          p = pathlib.Path(os.environ["FILE"])
          txt = p.read_text(encoding="utf-8")

          # Fix broken quotes inside single-quoted Dart strings:
          txt = txt.replace("داخل '...'.", "داخل \\'...\\'.")
          txt = txt.replace("نه '...'.", "نه \\'...\\'.")

          p.write_text(txt, encoding="utf-8")
          print("OK patched", p)
          PY
        env:
          FILE: ${{ steps.root.outputs.root }}/lib/src/services/error_lab_engine.dart
